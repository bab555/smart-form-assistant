[[memory:3583862]] # æ™ºèƒ½è¡¨å•åŠ©æ‰‹åç«¯ - å¿«é€Ÿå¼€å§‹æŒ‡å—

## ğŸ“¦ ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºè™šæ‹Ÿç¯å¢ƒ

### Windows (PowerShell)
```powershell
cd backend
python -m venv venv
venv\Scripts\activate
```

### Linux / macOS
```bash
cd backend
python3.12 -m venv venv
source venv/bin/activate
```

## ğŸ“¥ ç¬¬äºŒæ­¥ï¼šå®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

**å®‰è£…æ—¶é—´**ï¼šçº¦ 3-5 åˆ†é’Ÿï¼ˆå–å†³äºç½‘é€Ÿï¼‰

**å¦‚æœé‡åˆ°å®‰è£…å¤±è´¥**ï¼š
```bash
# ä½¿ç”¨æ¸…åé•œåƒæº
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
```

## âš™ï¸ ç¬¬ä¸‰æ­¥ï¼šé…ç½®ç¯å¢ƒå˜é‡

1. å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿ï¼š
```bash
cp .env.example .env
```

2. ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œå¡«å…¥æ‚¨çš„é˜¿é‡Œäº‘å‡­è¯ï¼š

```ini
# å¿…å¡«é¡¹
ALIYUN_ACCESS_KEY_ID=your_access_key_id
ALIYUN_ACCESS_KEY_SECRET=your_access_key_secret

# å¯é€‰é¡¹ï¼ˆä½¿ç”¨é»˜è®¤å€¼å³å¯ï¼‰
ALIYUN_LLM_MODEL_MAIN=qwen-max
ALIYUN_LLM_MODEL_CALIBRATION=qwen-turbo
```

**è·å–é˜¿é‡Œäº‘å‡­è¯**ï¼š
- ç™»å½• [é˜¿é‡Œäº‘æ§åˆ¶å°](https://ram.console.aliyun.com/manage/ak)
- åˆ›å»º AccessKey
- å¼€é€š DashScope æœåŠ¡ï¼ˆé€šä¹‰åƒé—®ï¼‰

## ğŸ”§ ç¬¬å››æ­¥ï¼šåˆå§‹åŒ–æ•°æ®

```bash
python scripts/init_mock_data.py
```

è¿™ä¼šï¼š
- åˆ›å»º Mock å•†å“/å®¢æˆ·æ•°æ®åº“
- æ„å»º FAISS å‘é‡ç´¢å¼•
- æµ‹è¯•æ£€ç´¢å’Œæ ¡å‡†åŠŸèƒ½

**é¢„æœŸè¾“å‡º**ï¼š
```
[INFO] å¼€å§‹åˆå§‹åŒ– Mock æ•°æ®å’Œå‘é‡ç´¢å¼•
[INFO] å‡†å¤‡æ„å»ºç´¢å¼•ï¼Œå…± 100 æ¡æ•°æ®
[INFO] å‘é‡ç´¢å¼•æ„å»ºå®Œæˆï¼Œå…± 100 æ¡è®°å½•
âœ… åˆå§‹åŒ–å®Œæˆï¼
```

## ğŸš€ ç¬¬äº”æ­¥ï¼šå¯åŠ¨æœåŠ¡

### æ–¹å¼ 1ï¼šä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰

**Windows:**
```bash
start.bat
```

**Linux/macOS:**
```bash
chmod +x start.sh
./start.sh
```

### æ–¹å¼ 2ï¼šç›´æ¥è¿è¡Œ

```bash
python main.py
```

### æ–¹å¼ 3ï¼šä½¿ç”¨ uvicorn

```bash
uvicorn main:app --host 0.0.0.0 --port 8000 --reload
```

## âœ… ç¬¬å…­æ­¥ï¼šéªŒè¯æœåŠ¡

### 1. æ£€æŸ¥å¥åº·çŠ¶æ€
```bash
curl http://localhost:8000/api/health
```

**é¢„æœŸè¿”å›**ï¼š
```json
{
  "status": "healthy",
  "service": "smart-form-backend"
}
```

### 2. è®¿é—® API æ–‡æ¡£

æµè§ˆå™¨æ‰“å¼€ï¼š
- **Swagger UI**: http://localhost:8000/docs
- **ReDoc**: http://localhost:8000/redoc

### 3. æµ‹è¯•å‘é‡æ£€ç´¢

åœ¨ Python ç¯å¢ƒä¸­æµ‹è¯•ï¼š
```python
import asyncio
from app.services.knowledge_base import vector_store

async def test():
    await vector_store.initialize()
    results = await vector_store.search("çº¢å¯ŒåœŸè‹¹æœ", category="product")
    print(results)

asyncio.run(test())
```

## ğŸ“¡ æµ‹è¯• API æ¥å£

### æµ‹è¯•å›¾ç‰‡è¯†åˆ«æ¥å£

```bash
curl -X POST "http://localhost:8000/api/workflow/visual" \
  -H "accept: application/json" \
  -H "Content-Type: multipart/form-data" \
  -F "file=@test_image.jpg"
```

### æµ‹è¯•æ¨¡æ¿åˆ—è¡¨æ¥å£

```bash
curl http://localhost:8000/api/template/list
```

### æµ‹è¯• WebSocket

åˆ›å»ºæµ‹è¯•æ–‡ä»¶ `test_ws.py`ï¼š
```python
import asyncio
import websockets
import json

async def test_websocket():
    uri = "ws://localhost:8000/ws/agent"
    async with websockets.connect(uri) as websocket:
        # å‘é€ ping
        await websocket.send(json.dumps({"type": "ping"}))
        
        # æ¥æ”¶å“åº”
        response = await websocket.recv()
        print(f"æ”¶åˆ°: {response}")

asyncio.run(test_websocket())
```

è¿è¡Œï¼š
```bash
pip install websockets
python test_ws.py
```

## ğŸ› å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜ 1ï¼šç«¯å£è¢«å ç”¨

**é”™è¯¯ä¿¡æ¯**ï¼š`Address already in use`

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# ä¿®æ”¹ .env ä¸­çš„ç«¯å£
PORT=8001

# æˆ–è€…æ€æ­»å ç”¨è¿›ç¨‹
# Windows
netstat -ano | findstr :8000
taskkill /PID <è¿›ç¨‹ID> /F

# Linux/macOS
lsof -ti:8000 | xargs kill -9
```

### é—®é¢˜ 2ï¼šé˜¿é‡Œäº‘ API è°ƒç”¨å¤±è´¥

**é”™è¯¯ä¿¡æ¯**ï¼š`Invalid AccessKeyId`

**æ£€æŸ¥æ¸…å•**ï¼š
- [ ] `.env` æ–‡ä»¶ä¸­çš„ `ALIYUN_ACCESS_KEY_ID` æ˜¯å¦æ­£ç¡®
- [ ] AccessKey æ˜¯å¦å·²å¯ç”¨
- [ ] æ˜¯å¦å·²å¼€é€š DashScope æœåŠ¡

### é—®é¢˜ 3ï¼šFAISS ç´¢å¼•åŠ è½½å¤±è´¥

**é”™è¯¯ä¿¡æ¯**ï¼š`No such file or directory: './data/vector_store.index'`

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# é‡æ–°åˆå§‹åŒ–
python scripts/init_mock_data.py
```

### é—®é¢˜ 4ï¼šä¾èµ–å®‰è£…å¤±è´¥

**é”™è¯¯ä¿¡æ¯**ï¼š`No matching distribution found for faiss-cpu`

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ–¹æ¡ˆ 1ï¼šä½¿ç”¨ conda
conda install -c pytorch faiss-cpu

# æ–¹æ¡ˆ 2ï¼šé™çº§ Python ç‰ˆæœ¬åˆ° 3.11
python3.11 -m venv venv

# æ–¹æ¡ˆ 3ï¼šä½¿ç”¨é¢„ç¼–è¯‘åŒ…
pip install faiss-cpu --no-cache-dir
```

## ğŸ“Š é¡¹ç›®ç»“æ„

```
backend/
â”œâ”€â”€ app/                    # åº”ç”¨ä»£ç 
â”‚   â”œâ”€â”€ api/               # API è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ endpoints.py   # RESTful æ¥å£
â”‚   â”‚   â””â”€â”€ websocket.py   # WebSocket æ¥å£
â”‚   â”œâ”€â”€ agents/            # LangGraph Agent
â”‚   â”‚   â”œâ”€â”€ graph.py       # å·¥ä½œæµå®šä¹‰
â”‚   â”‚   â”œâ”€â”€ prompts.py     # æç¤ºè¯
â”‚   â”‚   â””â”€â”€ skills/        # Agent æŠ€èƒ½
â”‚   â”œâ”€â”€ core/              # æ ¸å¿ƒé…ç½®
â”‚   â”‚   â”œâ”€â”€ config.py      # ç¯å¢ƒå˜é‡
â”‚   â”‚   â”œâ”€â”€ logger.py      # æ—¥å¿—é…ç½®
â”‚   â”‚   â””â”€â”€ events.py      # ç”Ÿå‘½å‘¨æœŸ
â”‚   â”œâ”€â”€ services/          # æœåŠ¡å±‚
â”‚   â”‚   â”œâ”€â”€ aliyun_llm.py  # å¤§æ¨¡å‹æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ aliyun_ocr.py  # OCR æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ aliyun_asr.py  # ASR æœåŠ¡
â”‚   â”‚   â””â”€â”€ knowledge_base.py # å‘é‡æ£€ç´¢
â”‚   â”œâ”€â”€ models/            # æ•°æ®æ¨¡å‹
â”‚   â”‚   â””â”€â”€ schemas.py     # Pydantic æ¨¡å‹
â”‚   â””â”€â”€ utils/             # å·¥å…·å‡½æ•°
â”‚       â””â”€â”€ helpers.py
â”œâ”€â”€ data/                  # æ•°æ®æ–‡ä»¶
â”‚   â”œâ”€â”€ vector_store.index # FAISS ç´¢å¼•
â”‚   â””â”€â”€ metadata.pkl       # å…ƒæ•°æ®
â”œâ”€â”€ logs/                  # æ—¥å¿—æ–‡ä»¶
â”œâ”€â”€ scripts/               # è„šæœ¬
â”‚   â””â”€â”€ init_mock_data.py # åˆå§‹åŒ–è„šæœ¬
â”œâ”€â”€ main.py               # ä¸»å…¥å£
â”œâ”€â”€ requirements.txt      # ä¾èµ–åˆ—è¡¨
â”œâ”€â”€ .env                  # ç¯å¢ƒå˜é‡ï¼ˆéœ€åˆ›å»ºï¼‰
â””â”€â”€ README.md            # é¡¹ç›®è¯´æ˜
```

## ğŸ”§ å¼€å‘æ¨¡å¼

### å¯ç”¨çƒ­é‡è½½

```bash
# .env ä¸­è®¾ç½®
RELOAD=true

# æˆ–ç›´æ¥è¿è¡Œ
uvicorn main:app --reload
```

### æŸ¥çœ‹æ—¥å¿—

```bash
# å®æ—¶æŸ¥çœ‹
tail -f logs/app.log

# Windows
Get-Content logs/app.log -Wait
```

### è°ƒè¯•æ¨¡å¼

```python
# åœ¨ä»£ç ä¸­æ·»åŠ 
import pdb; pdb.set_trace()

# æˆ–ä½¿ç”¨ VS Code è°ƒè¯•é…ç½®
```

## ğŸ“– ä¸‹ä¸€æ­¥

1. é˜…è¯» [04_backend_spec.md](./04_backend_spec.md) äº†è§£æŠ€æœ¯ç»†èŠ‚
2. æŸ¥çœ‹ [å¼€å‘å·¥ä½œæµ.md](./å¼€å‘å·¥ä½œæµ.md) å­¦ä¹ å¼€å‘æµç¨‹
3. å¯åŠ¨å‰ç«¯æœåŠ¡è¿›è¡Œè”è°ƒæµ‹è¯•
4. æä¾›çœŸå®æµ‹è¯•å›¾ç‰‡å’ŒéŸ³é¢‘æ–‡ä»¶

## ğŸ†˜ è·å–å¸®åŠ©

- æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ï¼š`logs/app.log`
- æŸ¥çœ‹ FastAPI æ–‡æ¡£ï¼šhttp://localhost:8000/docs
- æ£€æŸ¥é…ç½®ï¼š`.env` æ–‡ä»¶
- æµ‹è¯•ç»„ä»¶ï¼šè¿è¡Œ `scripts/init_mock_data.py`

---

**ç¥æ‚¨ä½¿ç”¨æ„‰å¿«ï¼** ğŸ‰

